/* Program Page Styles - Global CSS for htmx compatibility
 *
 * HVORFOR GLOBAL CSS I STEDET FOR SCOPED CSS?
 * ============================================
 *
 * Astro bruker normalt "scoped CSS" som automatisk legger til unike attributter
 * (data-astro-cid-xyz123) på HTML-elementer når siden bygges. Dette gjør at CSS
 * kun påvirker komponenten den tilhører.
 *
 * PROBLEMET MED HTMX:
 * - Når programsiden lastes første gang, genererer Astro HTML med scoped attributter:
 *   <div class="grid" data-astro-cid-abc123>
 *
 * - Når htmx henter nytt innhold fra API-endepunktet (/api/filter-program.ts),
 *   genererer APIen HTML uten disse compile-time attributtene:
 *   <div class="grid">
 *
 * - Scoped CSS kompileres til:
 *   .grid[data-astro-cid-abc123] { display: grid; }
 *
 * - Denne CSS-regelen matcher IKKE HTML fra API (mangler attributtet)
 * - Resultat: All styling forsvinner etter htmx-swap
 *
 * LØSNINGEN MED GLOBAL CSS:
 * - Global CSS matcher bare klassenavn, uten attributter:
 *   .grid { display: grid; }
 *
 * - Dette fungerer både for:
 *   1. Initial server-rendered HTML fra program.astro
 *   2. Dynamisk HTML fra /api/filter-program.ts via htmx
 *
 * HVILKE FILER BRUKER DENNE CSS-FILEN:
 * - /pages/program.astro (initial render)
 * - /pages/api/filter-program.ts (htmx responses)
 * - /components/DateFilter.astro (filter-knapper)
 */

/* ============================================
   DATE FILTER - CONDITIONAL HORIZONTAL SCROLL
   ============================================

   Robust solution for 5-8 date buttons.
   Uses container queries to switch between:
   - Wide containers (>1100px): Allow wrapping
   - Narrow containers (<1100px): Horizontal scroll

   Intrinsic approach - adapts based on available space.
*/

.date-filter {
  /* Enable container queries for responsive behavior */
  container-type: inline-size;
  container-name: date-filter;
}

/* Base styles - always single line with scroll when needed */
.date-filter-buttons {
  display: flex;
  gap: var(--space-3);
  align-items: center;

  /* Never wrap - always single horizontal line */
  flex-wrap: nowrap;

  /* Enable horizontal scroll when buttons don't fit */
  overflow-x: auto;
  overflow-y: hidden;

  /* Performance optimization */
  contain: layout style inline-size;

  /* Position for pseudo-element scrollbar indicator */
  position: relative;
}

/* Ensure buttons size naturally */
.date-filter-buttons .link-button {
  flex: 0 0 auto;
  white-space: nowrap;
  /* Smaller button size */
  padding: var(--space-2) var(--space-4);
  font-size: var(--step--1);
}

/* Event count indicator - subtle styling */
.event-count {
  font-size: var(--step--1);
  opacity: 0.75;
  font-weight: var(--font-weight-normal);
  margin: 0 0 var(--space-4) 0;
}

/* ============================================
   HORIZONTAL SCROLL MODE
   ============================================

   Activate when container is too narrow for all buttons.
   Breakpoint: 1100px (safe for up to 8 buttons)
*/

@container date-filter (max-width: 1100px) {
  .date-filter-buttons {
    /* Disable wrapping - enable horizontal scroll */
    flex-wrap: nowrap;
    overflow-x: scroll;
    overflow-y: hidden;

    /* Smooth scrolling behavior */
    scroll-behavior: smooth;
    overscroll-behavior-x: contain;

    /* Scroll padding for better UX */
    scroll-padding-inline: clamp(1rem, 3vw, 2rem);

    /* Space for scrollbar underneath buttons */
    padding-block-end: 12px;

    /* Scroll snap for better UX */
    scroll-snap-type: x mandatory;
  }

  .date-filter-buttons .link-button {
    /* Snap to start of each button */
    scroll-snap-align: start;
    scroll-margin-inline-start: 0.5rem;
  }

  /* Styled native scrollbar - always visible and functional
   * Pattern defined in utilities.css (.scrollbar-styled)
   * Kept inline here due to container query context */
  .date-filter-buttons {
    scrollbar-width: thin;
    scrollbar-color: var(--color-blue) var(--color-neutral-100);
  }

  .date-filter-buttons::-webkit-scrollbar {
    height: 4px;
    -webkit-appearance: none;
  }

  .date-filter-buttons::-webkit-scrollbar-track {
    background: var(--color-neutral-100);
    border-radius: 0;
  }

  .date-filter-buttons::-webkit-scrollbar-thumb {
    background: var(--color-blue);
    border-radius: 0;
  }

  .date-filter-buttons::-webkit-scrollbar-thumb:hover {
    background: var(--color-green);
  }

  /* Keyboard focus indicator */
  .date-filter-buttons:focus-visible {
    outline: 2px solid var(--color-blue);
    outline-offset: 2px;
  }
}

/* ============================================
   TOUCH DEVICE OPTIMIZATIONS
   ============================================ */

@media (pointer: coarse) {
  /* Larger touch targets regardless of scroll mode */
  .date-filter-buttons .link-button {
    min-block-size: 44px;
    padding-inline: clamp(1rem, 3vw, 1.5rem);
  }
}

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .date-filter-buttons {
    scroll-behavior: auto;
  }
}

/* ============================================
   VENUE FILTER - SAME BEHAVIOR AS DATE FILTER
   ============================================

   Identical structure and behavior to date filter.
   Uses container queries to switch between wrapping and scrolling.
*/

.venue-filter {
  /* Enable container queries for responsive behavior */
  container-type: inline-size;
  container-name: venue-filter;

  /* Spacing above venue filter to separate from date filter */
  margin-block-start: var(--space-4);
}

/* Base styles - always single line with scroll when needed */
.venue-filter-buttons {
  display: flex;
  gap: var(--space-3);
  align-items: center;

  /* Never wrap - always single horizontal line */
  flex-wrap: nowrap;

  /* Enable horizontal scroll when buttons don't fit */
  overflow-x: auto;
  overflow-y: hidden;

  /* Performance optimization */
  contain: layout style inline-size;

  /* Position for pseudo-element scrollbar indicator */
  position: relative;
}

/* Ensure buttons size naturally */
.venue-filter-buttons .link-button {
  flex: 0 0 auto;
  white-space: nowrap;
  /* Smaller button size */
  padding: var(--space-2) var(--space-4);
  font-size: var(--step--1);
}

/* ============================================
   HORIZONTAL SCROLL MODE FOR VENUE FILTER
   ============================================

   Activate when container is too narrow for all buttons.
   Breakpoint: 1100px (same as date filter)
*/

@container venue-filter (max-width: 1100px) {
  .venue-filter-buttons {
    /* Disable wrapping - enable horizontal scroll */
    flex-wrap: nowrap;
    overflow-x: scroll;
    overflow-y: hidden;

    /* Smooth scrolling behavior */
    scroll-behavior: smooth;
    overscroll-behavior-x: contain;

    /* Scroll padding for better UX */
    scroll-padding-inline: clamp(1rem, 3vw, 2rem);

    /* Space for scrollbar underneath buttons */
    padding-block-end: 12px;

    /* Pull up to compensate for date-filter's scrollbar padding */
    margin-block-start: -12px;

    /* Scroll snap for better UX */
    scroll-snap-type: x mandatory;
  }

  .venue-filter-buttons .link-button {
    /* Snap to start of each button */
    scroll-snap-align: start;
    scroll-margin-inline-start: 0.5rem;
  }

  /* Styled native scrollbar - always visible and functional
   * Pattern defined in utilities.css (.scrollbar-styled)
   * Kept inline here due to container query context */
  .venue-filter-buttons {
    scrollbar-width: thin;
    scrollbar-color: var(--color-blue) var(--color-neutral-100);
  }

  .venue-filter-buttons::-webkit-scrollbar {
    height: 4px;
    -webkit-appearance: none;
  }

  .venue-filter-buttons::-webkit-scrollbar-track {
    background: var(--color-neutral-100);
    border-radius: 0;
  }

  .venue-filter-buttons::-webkit-scrollbar-thumb {
    background: var(--color-blue);
    border-radius: 0;
  }

  .venue-filter-buttons::-webkit-scrollbar-thumb:hover {
    background: var(--color-green);
  }

  /* Keyboard focus indicator */
  .venue-filter-buttons:focus-visible {
    outline: 2px solid var(--color-blue);
    outline-offset: 2px;
  }
}

/* Touch device optimizations for venue filter */
@media (pointer: coarse) {
  /* Increase spacing between date and venue filters for touch accuracy */
  .venue-filter {
    margin-block-start: var(--space-6);  /* 24-30px instead of 12-15px */
  }

  .venue-filter-buttons .link-button {
    min-block-size: 44px;
    padding-inline: clamp(1rem, 3vw, 1.5rem);
  }
}

/* Respect reduced motion preferences for venue filter */
@media (prefers-reduced-motion: reduce) {
  .venue-filter-buttons {
    scroll-behavior: auto;
  }
}

/* Loading indicator - Delayed appearance for perceived performance
 *
 * UX Pattern: "Optimistic UI" - used by Google, Facebook, GitHub, Stripe
 * Based on Doherty Threshold research (400ms perceived instantaneousness)
 *
 * Behavior:
 * - Requests under 250ms: No loading indicator (feels instant)
 * - 250-400ms: Gradually fades in
 * - 400ms+: Fully visible
 *
 * Accessibility: Respects prefers-reduced-motion
 */
#filter-loading {
  --loading-delay: 250ms;
  --loading-fade-in: 150ms;
  --loading-fade-out: 100ms;

  margin-block-start: var(--space-3);
  font-size: var(--step--1);
  font-style: italic;

  /* Hidden state - prevents interaction and screen reader announcement */
  opacity: 0;
  visibility: hidden;
  pointer-events: none;

  /* Delayed fade-in: starts at 250ms, completes at 400ms */
  transition:
    opacity var(--loading-fade-in) ease-in-out var(--loading-delay),
    visibility 0ms linear var(--loading-delay);

  /* Performance: Force hardware acceleration */
  will-change: opacity;
  transform: translateZ(0);
}

#filter-loading.htmx-request {
  /* Visible state - allows interaction and screen reader announcement */
  opacity: 1;
  visibility: visible;
  pointer-events: auto;

  /* Apply delay to both properties */
  transition-delay: var(--loading-delay), 0ms;
}

/* Faster fade-out when request completes */
#filter-loading:not(.htmx-request) {
  transition:
    opacity var(--loading-fade-out) ease-out,
    visibility 0ms linear var(--loading-fade-out);
}

/* Accessibility: Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  #filter-loading {
    --loading-delay: 0ms;
    --loading-fade-in: 50ms;
    --loading-fade-out: 50ms;
  }
}

/* Date filter buttons now use global .link-button class from global.css
   This ensures consistency across the site */

/* htmx loading state for date filters */
.link-button.htmx-request {
  opacity: 0.6;
  cursor: wait;
}

/* Section Layout */
.content-section {
  /* Top margin to separate from filtering section */
  margin-block-start: var(--space-m-l);  /* 16-30px fluid */
  margin-block-end: 0;
  margin-inline: 0;
}

.date-section {
  /* Spacing between date sections - 64px for clear visual separation */
  margin-block-end: var(--space-9);
}

.date-section:last-child {
  /* Remove margin from last date section */
  margin-block-end: 0;
}

.date-title {
  /* ============================================
     FULL VIEWPORT-WIDTH BACKGROUND FOR DATE TITLES
     ============================================

     Creates a full-width colored band that extends to viewport
     edges while keeping text content aligned with the container.

     Safe to use viewport units here because it's just a thin
     horizontal band with no height constraints that could cause
     horizontal scroll issues.
  */

  /* Position relative for pseudo-element */
  position: relative;

  /* Typography styling */
  margin-block-start: 0;
  margin-block-end: var(--space-5);
  padding-block: var(--space-4);
  font-size: var(--step-2);
  font-weight: var(--font-weight-semibold);
  font-family: var(--font-family-sans);
  color: var(--color-blue);
  letter-spacing: -0.01em;
}

/* Full viewport-width background band removed - no background tint */

/* Fixed-Size Grid System - NRK-inspired approach */
.events-grid {
  container-type: inline-size;
  display: grid;
  gap: clamp(var(--space-l), 3vw, var(--space-6));
  /* Fixed 320px cards - fits as many as possible */
  grid-template-columns: repeat(auto-fill, 320px);
  padding: 0;
  contain: layout style;
  /* Left-align cards to match date titles */
  justify-content: start;
}

/* ============================================
   HORIZONTAL SCROLL MODE FOR EVENT CARDS
   ============================================

   Below 800px container width, switch from wrapping grid
   to horizontal scrolling flexbox. Each date section scrolls
   independently using scroll-container pattern.

   Scroll behavior and styling now handled by:
   - .scroll-container (base)
   - .scroll-container--event-cards (sizing)
   - .scroll-container--styled-scrollbar (scrollbar)
*/

@container (max-width: 800px) {
  .events-grid {
    /* Transform from grid to flex for scroll mode */
    display: flex;
    /* Clear grid properties */
    grid-template-columns: initial;
  }

  /* Override hover effect for horizontal scroll mode */
  @media (hover: hover) {
    .event-card:hover {
      /* Use scale instead of translateY to avoid clipping in scroll container */
      transform: scale(1.02);
      box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;
      background-color: rgba(0, 179, 154, 0.08);
    }
  }
}

/* No Results State */
.no-results {
  text-align: center;
  padding: var(--space-8) var(--space-4);
}

.no-results-title {
  margin: 0 0 var(--space-2) 0;
  font-size: var(--step-1);
  line-height: var(--line-height-relaxed);
}

.no-results-text {
  margin: 0 0 var(--space-5) 0;
  font-size: var(--step-1);
  line-height: var(--line-height-relaxed);
}

/* Reset button matches filter button size */
.no-results .link-button {
  padding: var(--space-2) var(--space-4);
  font-size: var(--step--1);
}

/* ============================================
   EVENT CARD STYLES
   Moved to event-card.css for reusability
   Event card component can now be used in:
   - Program page (this page)
   - PageBuilder on any page
   - Event scroll containers
   ============================================ */
/* All .event-card styles now in event-card.css */

/* ============================================
   ACCESSIBILITY & MOTION PREFERENCES
   ============================================ */

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .events-grid {
    scroll-behavior: auto;
  }
  /* Event card motion preferences moved to event-card.css */
}

/* Touch device optimizations for scroll mode */
@media (pointer: coarse) {
  @container (max-width: 800px) {
    .events-grid {
      /* Larger scrollbar for touch devices */
      scrollbar-width: auto;
    }

    .events-grid::-webkit-scrollbar {
      height: 12px;
    }
  }
}

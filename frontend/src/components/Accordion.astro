---
import Image from './Image.astro'
import Video from './Video.astro'
import Button from './Button.astro'
import Title from './Title.astro'
import Quote from './Quote.astro'
import Heading from './Heading.astro'
import PortableText from './PortableText.astro'

export interface Props {
  description?: string
  panels?: Array<{
    title: string
    content: any[]
  }>
  className?: string
}

const {
  description,
  panels = [],
  className = ''
} = Astro.props
---

<div class={`accordion ${className}`}>
  {description && <p class="accordion-description">{description}</p>}

  {panels && panels.length > 0 ? (
    panels.map((panel) => (
      <details class="accordion-panel" name="accordion-group">
        <summary class="accordion-summary">
          {panel.title}
        </summary>
        <div class="accordion-content">
          {panel.content && panel.content.length > 0 ? (
            panel.content.map((item) => {
              switch (item._type) {
                case 'block':
                  return <PortableText value={[item]} semantic="div" />
                case 'imageComponent':
                  return <Image {...item} />
                case 'videoComponent':
                  return <Video {...item} />
                case 'buttonComponent':
                  return <Button {...item} />
                case 'title':
                  return <Title {...item} />
                case 'quoteComponent':
                  return <Quote {...item} />
                case 'heading':
                  return <Heading {...item} />
                default:
                  return <div>Ukjent komponent: {item._type}</div>
              }
            })
          ) : (
            <div>Ingen innhold</div>
          )}
        </div>
      </details>
    ))
  ) : (
    <div class="no-panels">
      <p>Ingen paneler tilgjengelig</p>
    </div>
  )}
</div>


<style>
  .accordion {
    width: min(65ch, 100% - 4rem); /* Same width as Quote component */
    max-width: 100%;
    margin-inline: auto; /* Center it */
    margin-block: var(--space-xl-2xl); /* Fluid section spacing */
    background: var(--color-yellow-50); /* Light yellow background for entire component */
    padding: var(--space-m-l); /* Padding around entire accordion */
  }

  .accordion-description {
    margin-bottom: var(--space-l);
    line-height: var(--line-height-normal);
    color: var(--color-yellow-900); /* Dark yellow text to match theme */
  }

  .accordion-panel {
    border: 2px solid var(--color-yellow-200); /* Visible border around each panel */
    margin-bottom: var(--space-s); /* Space between panels */
  }

  .accordion-panel:last-child {
    margin-bottom: 0; /* No margin on last panel */
  }

  .accordion-summary {
    padding: var(--space-m) var(--space-m-l); /* Fluid padding */
    background: var(--color-yellow-100); /* Light yellow tint */
    color: var(--color-yellow-900); /* Dark yellow text */
    cursor: pointer;
    font-weight: var(--font-weight-medium); /* 500 */
    transition: background-color 0.2s ease;
    list-style: none;
    position: relative;
  }

  /* Remove default marker */
  .accordion-summary::-webkit-details-marker {
    display: none;
  }

  .accordion-summary::after {
    content: '';
    position: absolute;
    right: 1.5rem;
    top: 50%;
    transform: translateY(-50%) rotate(45deg);
    width: 8px;
    height: 8px;
    border-right: 2px solid var(--color-yellow-900);
    border-bottom: 2px solid var(--color-yellow-900);
    transition: transform 0.2s ease;
  }

  .accordion-panel[open] .accordion-summary::after {
    transform: translateY(-50%) rotate(-135deg);
  }

  .accordion-summary:hover {
    background: var(--color-yellow-200); /* Slightly darker on hover */
  }

  .accordion-summary:active {
    background: var(--color-yellow-100); /* Keep yellow during click */
  }

  .accordion-summary:focus {
    outline: 2px solid var(--color-yellow-900);
    outline-offset: -2px;
  }

  .accordion-panel {
    background: var(--color-yellow-50); /* Fill entire panel with yellow to prevent green flash */
  }

  .accordion-content {
    padding: var(--space-m) var(--space-m-l); /* Fluid padding */
    background: var(--color-yellow-50); /* Very light yellow background */
    color: var(--color-yellow-900); /* Dark yellow text */
    line-height: var(--line-height-normal);
  }

  .no-panels {
    padding: var(--space-m) var(--space-m-l); /* Fluid padding */
    text-align: center;
  }
</style> 
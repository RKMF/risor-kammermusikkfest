---
/**
 * DynamicComponent - Renders CMS content blocks by type
 *
 * This is the gateway component for all Sanity page content. It maps each
 * content block's _type to a registered Astro component and renders it.
 *
 * Unknown component types show a debug warning (visible only in development)
 * to help editors and developers identify missing implementations.
 *
 * @see src/lib/componentRegistry.ts - Component type mappings
 *
 * @example
 * ```astro
 * {content.map((block) => <DynamicComponent block={block} />)}
 * ```
 */

import { componentRegistry, isRegisteredComponent, type ContentBlock } from '../lib/componentRegistry';

/** A content block from Sanity with a _type field */
interface Props {
  block: ContentBlock;
}

const { block } = Astro.props;

// Look up the Astro component for this block's _type
const Component = componentRegistry[block._type];
const isKnownComponent = isRegisteredComponent(block._type);
---

{isKnownComponent && Component ? (
  <Component {...block} />
) : (
  <div class="unknown-component">
    <p>⚠️ Ukjent komponent: <code>{block._type}</code></p>
    <details>
      <summary>Debug info</summary>
      <pre>{JSON.stringify(block, null, 2)}</pre>
    </details>
  </div>
)}

<style>
  .unknown-component {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    padding: var(--space-m); /* Fluid 16px → 20px */
    margin-block: var(--space-m); /* Fluid 16px → 20px */
  }

  .unknown-component code {
    background: #f8f9fa;
    padding: var(--space-3xs) var(--space-2xs); /* Fluid precision spacing */
    font-family: monospace;
  }

  .unknown-component details {
    margin-top: var(--space-xs); /* Fluid 8px → 10px */
  }

  .unknown-component pre {
    background: #f8f9fa;
    padding: var(--space-xs); /* Fluid 8px → 10px */
    overflow-x: auto;
    font-size: 0.8rem;
  }
</style>
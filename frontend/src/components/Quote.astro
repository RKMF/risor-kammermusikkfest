---
export interface Props {
  quote: string
  author?: string
  source?: string
  cite?: string
  className?: string
}

const {
  quote,
  author,
  source,
  cite,
  className = ''
} = Astro.props
---

<blockquote
  class={`quote-component ${className}`}
  data-component="quote"
  cite={cite}
>
  <div class="quote-text">{quote}</div>
  {(author || source) && (
    <cite class="quote-attribution">
      {author && <span class="quote-author">{author}</span>}
      {author && source && <span class="quote-separator"></span>}
      {source && <span class="quote-source">{source}</span>}
    </cite>
  )}
</blockquote>

<style>
  /* CSS Variable-based width control - Kevin Powell method */
  .quote-component {
    width: var(--component-width, min(65ch, 100% - 4rem));
    max-width: var(--component-max-width, 100%);
    margin-inline: auto;
    margin-block: var(--space-l-xl); /* Fluid 24px → 40px */
    padding: var(--space-m-l); /* Fluid 16px → 30px */
    background: var(--color-red-100); /* AAA contrast with red-900 (8.76:1) */
    color: var(--color-red-900); /* Darkest red text */
    border: none;
    box-shadow: var(--shadow-sm); /* Subtle depth */

    /* Container query context */
    container-type: inline-size;
    container-name: quote;
  }

  /* When inside a layout context, fill parent space */
  :global([data-layout-context]) .quote-component {
    width: 100%;
    height: 100%;
    margin: 0;
    display: flex;
    flex-direction: column;
  }

  :global([data-layout-context]) .quote-text {
    flex: 1;
    overflow-y: auto;
  }

  .quote-text {
    font-size: var(--step-1); /* Fluid 20px → 23px */
    font-weight: var(--font-weight-medium); /* 500 */
    line-height: var(--line-height-normal); /* 1.6 */
    font-style: normal; /* Modern, not italic */
    margin-block-end: var(--space-s);
    text-wrap: balance; /* Even out line lengths for better visual balance */
    overflow-wrap: break-word; /* Prevent overflow on long words */
  }

  .quote-attribution {
    display: flex;
    align-items: center;
    justify-content: flex-end; /* Align to right */
    gap: var(--space-xs);
    margin-block-start: var(--space-l); /* More vertical space (24-30px) */
    font-size: var(--step--1); /* Fluid 13px → 14px */
    font-style: normal;
    color: var(--color-red-900); /* Match quote text color */
    text-align: right; /* Right-align text */
  }

  .quote-author {
    font-weight: var(--font-weight-semibold); /* 600 */
  }

  .quote-separator::before {
    content: '·'; /* Interpunct instead of comma */
  }

  .quote-source {
    font-style: italic;
  }

  /* Container query: Adjust at narrow widths */
  @container quote (max-width: 500px) {
    .quote-component {
      padding: var(--space-s-m); /* 12px → 20px */
    }

    .quote-text {
      font-size: var(--step-0); /* 16px → 18px */
    }
  }

  @container quote (max-width: 350px) {
    .quote-attribution {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-3xs);
    }
  }

  /* Note: No viewport media queries needed! Quote adapts to its container size */

  /* Accessibility */
  .quote-component:focus-within {
    outline: 2px solid var(--color-blue);
    outline-offset: 2px;
  }

  /* Respect user preferences for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .quote-component {
      transition: none;
    }
  }
</style> 
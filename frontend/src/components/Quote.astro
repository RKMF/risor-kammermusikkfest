---
export interface Props {
  quote: string
  author?: string
  source?: string
  cite?: string
  className?: string
}

const {
  quote,
  author,
  source,
  cite,
  className = ''
} = Astro.props
---

<figure class={`quote-figure ${className}`} data-component="quote">
  <blockquote class="quote-component" cite={cite}>
    <p class="quote-text">{quote}</p>
  </blockquote>
  {(author || source) && (
    <figcaption class="quote-attribution">
      {author && <span class="quote-author">{author}</span>}
      {source && <cite class="quote-source">{source}</cite>}
    </figcaption>
  )}
</figure>

<style>
  /* CSS Variable-based width control - Kevin Powell method */
  .quote-figure {
    width: var(--component-width, min(65ch, 100% - 4rem));
    max-width: var(--component-max-width, 100%);
    margin-inline: auto;
    margin-block: var(--space-l-xl); /* Fluid 24px → 40px */
    padding: var(--space-m-l); /* Fluid 16px → 30px */
    background: var(--color-red-50); /* Lighter tint, matching accordion summary level */
    color: var(--color-red-900); /* Darkest red text */
    border: none;
    box-shadow: var(--shadow-sm); /* Subtle depth */

    /* Grid layout: quote on top, attribution below */
    display: grid;
    grid-template-rows: 1fr auto;
    gap: var(--space-m);

    /* Container query context */
    container-type: inline-size;
    container-name: quote;
  }

  /* Blockquote inside figure - centered horizontally and vertically */
  .quote-component {
    margin: 0;
    justify-self: center;
    align-self: center;
  }

  /* When inside a layout context, fill parent space */
  :global([data-layout-context]) .quote-figure {
    width: 100%;
    height: 100%;
    margin: 0;
  }

  .quote-text {
    font-size: var(--step-2); /* TODO: Explore fluid sizing with container queries later */
    font-weight: var(--font-weight-medium); /* 500 */
    line-height: var(--line-height-normal); /* 1.6 */
    font-style: normal; /* Modern, not italic */
    margin: 0;
    text-wrap: balance; /* Even out line lengths for better visual balance */
    overflow-wrap: break-word; /* Prevent overflow on long words */
  }

  .quote-attribution {
    display: flex;
    align-items: center;
    gap: var(--space-3xs);
    font-size: var(--step--1); /* Fluid 13px → 14px */
    line-height: var(--line-height-tight); /* Tighter line-height */
    font-style: normal;
    color: var(--color-red-900); /* Match quote text color */
  }

  .quote-author {
    font-weight: var(--font-weight-semibold); /* 600 */
  }

  .quote-source {
    font-style: italic;
  }

  /* Container query: Adjust at narrow widths */
  @container quote (max-width: 500px) {
    .quote-figure {
      padding: var(--space-s-m); /* 12px → 20px */
    }

    .quote-text {
      font-size: var(--step-0); /* 16px → 18px */
    }
  }

  @container quote (max-width: 350px) {
    .quote-attribution {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-3xs);
    }
  }

  /* Note: No viewport media queries needed! Quote adapts to its container size */

  /* Accessibility */
  .quote-figure:focus-within {
    outline: 2px solid var(--color-blue);
    outline-offset: 2px;
  }

  /* Respect user preferences for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .quote-figure {
      transition: none;
    }
  }
</style> 
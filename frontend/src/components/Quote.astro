---
export interface Props {
  quote: string
  author?: string
  source?: string
  cite?: string
  className?: string
}

const {
  quote,
  author,
  source,
  cite,
  className = ''
} = Astro.props
---

<figure class={`quote-figure ${className}`} data-component="quote">
  <blockquote class="quote-component" cite={cite}>
    <p class="quote-text">{quote}</p>
  </blockquote>
  {(author || source) && (
    <figcaption class="quote-attribution">
      {author && <span class="quote-author">{author}</span>}
      {source && <cite class="quote-source">{source}</cite>}
    </figcaption>
  )}
</figure>

<style>
  /* CSS Variable-based width control - Kevin Powell method */
  .quote-figure {
    position: relative; /* For quote mark positioning */
    overflow: hidden; /* Clip the oversized quote mark */
    width: var(--component-width, min(65ch, 100% - 4rem));
    max-width: var(--component-max-width, 100%);
    margin-inline: auto;
    margin-block: var(--space-l-xl); /* Fluid 24px → 40px */
    padding: var(--space-m-l); /* Fluid 16px → 30px */
    background: var(--color-red-50); /* Lighter tint, matching accordion summary level */
    color: var(--color-red-900); /* Darkest red text */
    border: none;

    /* Grid layout: quote on top, attribution below */
    display: grid;
    grid-template-rows: 1fr auto;
    gap: var(--space-m);

    /* Container query context */
    container-type: inline-size;
    container-name: quote;
  }

  /* Large decorative quote mark - background element */
  .quote-figure::before {
    content: "\201C"; /* Curly opening quote */
    position: absolute;
    top: 0;
    left: 0;
    font-size: clamp(var(--step-6), 180cqi, 50rem); /* Fluid: 180% of container, clamped */
    font-size-adjust: initial; /* Reset inherited adjustment */
    font-weight: var(--font-weight-black);
    line-height: 1;
    color: var(--color-red-100);
    z-index: 0; /* Behind content */
    pointer-events: none; /* Decorative only */
  }

  /* Blockquote inside figure - centered horizontally and vertically */
  .quote-component {
    margin: 0;
    justify-self: center;
    align-self: center;
    position: relative;
    z-index: 1; /* Above the background quote mark */
  }

  /* When inside a layout context, fill parent space */
  :global([data-layout-context]) .quote-figure {
    width: 100%;
    height: 100%;
    margin: 0;
  }

  .quote-text {
    font-size: var(--step-3); /* 31-44px */
    font-weight: var(--font-weight-medium); /* 500 */
    line-height: var(--line-height-normal); /* 1.6 */
    font-style: normal; /* Modern, not italic */
    margin: 0;
    text-wrap: balance; /* Even out line lengths for better visual balance */
    overflow-wrap: break-word; /* Prevent overflow on long words */
  }

  .quote-attribution {
    display: flex;
    flex-direction: column; /* Author above source */
    align-items: flex-end; /* Right-align text */
    gap: var(--space-3xs);
    justify-self: end; /* Right-align in grid */
    font-size: var(--step-0); /* Fluid 18px → 23px */
    line-height: var(--line-height-tight); /* Tighter line-height */
    font-style: normal;
    color: var(--color-red-900); /* Match quote text color */
    position: relative;
    z-index: 1; /* Above the background quote mark */
  }

  .quote-author {
    font-weight: var(--font-weight-semibold); /* 600 */
  }

  .quote-source {
    font-style: normal;
  }

  /* Container query: Adjust at narrow widths */
  @container quote (max-width: 500px) {
    .quote-figure {
      padding: var(--space-s-m); /* 12px → 20px */
    }

    .quote-text {
      font-size: var(--step-1); /* 22-28px */
    }
  }

  /* Note: No viewport media queries needed! Quote adapts to its container size */

  /* Accessibility */
  .quote-figure:focus-within {
    outline: 2px solid var(--color-blue);
    outline-offset: 2px;
  }

  /* Respect user preferences for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .quote-figure {
      transition: none;
    }
  }
</style> 
---
import DynamicComponent from './DynamicComponent.astro'

export interface Props {
  title?: string
  leftColumn: any[]
  rightColumn: any[]
  reverseOnMobile?: boolean
  className?: string
  _key?: string
  _type?: string
}

const {
  title,
  leftColumn = [],
  rightColumn = [],
  reverseOnMobile = false,
  className = '',
  _key,
  _type,
} = Astro.props

const leftItem = leftColumn[0]
const rightItem = rightColumn[0]

// Sanity Visual Editing attributes
const sanityAttributes = _key ? { 'data-sanity': `${_type}.${_key}` } : {}
---

{title && <h2 class="section-title">{title}</h2>}

<section
  class={`two-column-layout content-wide ${reverseOnMobile ? 'reverse-mobile' : ''} ${className}`}
  data-layout-context="two-column"
  style="--column-aspect-ratio: 4 / 3"
  {...sanityAttributes}
>
    <div class="column column-left">
      {leftItem && <DynamicComponent block={leftItem} />}
    </div>

    <div class="column column-right">
      {rightItem && <DynamicComponent block={rightItem} />}
    </div>
</section>

<style>
  .section-title {
    margin-block-end: var(--space-l-xl); /* Fluid 24px → 40px */
    font-size: var(--fs-2xl);
    font-weight: 600;
  }

  .two-column-layout {
    display: grid;
    /* Intrinsic: creates 2 columns when space allows, stacks when narrow */
    grid-template-columns: repeat(auto-fit, minmax(min(400px, 100%), 1fr));
    gap: var(--space-l-xl); /* Fluid 24px → 40px */
    margin-block: var(--space-xl-2xl); /* Fluid 32px → 60px section spacing */
    align-items: stretch; /* Columns stretch to match height */

    /* Container query context - allows children to adapt to available space */
    container-type: inline-size;
    container-name: two-column-layout;
  }

  .column {
    width: 100%;
    aspect-ratio: var(--column-aspect-ratio, 4 / 3);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 300px; /* Prevent tiny boxes */

    /* Performance optimizations */
    contain: layout style paint;
    content-visibility: auto;
  }

  /* Media content: Fill and crop */
  .column > :global(.image-container),
  .column > :global([data-component="video"]) {
    width: 100%;
    height: 100%;
    flex: 1;
  }

  .column > :global(.image-container .image),
  .column > :global(.image) {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Components that fill column space and respect aspect ratio */
  .column > :global([data-component="spotify"]),
  .column > :global([data-component="quote"]),
  .column > :global([data-component="video"]) {
    width: 100%;
    height: 100%;
    flex: 1;
  }

  /* Text content: Scrollable within fixed height */
  .column > :global([data-component="quote"]),
  .column > :global([data-component="text"]),
  .column > :global(.portable-text) {
    overflow-y: auto;
    height: 100%;
    padding: var(--space-m-l); /* Fluid 16px → 30px */

    /* Custom scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
  }

  .column > :global([data-component="quote"])::-webkit-scrollbar,
  .column > :global([data-component="text"])::-webkit-scrollbar,
  .column > :global(.portable-text)::-webkit-scrollbar {
    width: 8px;
  }

  .column > :global([data-component="quote"])::-webkit-scrollbar-thumb,
  .column > :global([data-component="text"])::-webkit-scrollbar-thumb,
  .column > :global(.portable-text)::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
  }

  /* Nested layouts: Natural height */
  .column > :global([data-layout-context]) {
    aspect-ratio: auto;
    height: auto;
    overflow: visible;
  }


  /* Container query: Adjust gap when columns stack */
  @container two-column-layout (max-width: 600px) {
    .two-column-layout {
      gap: var(--space-m-l); /* Fluid 16px → 30px */
      margin-block: var(--space-l-xl); /* Fluid 24px → 40px */
    }

    /* Reverse column order when stacked if specified */
    .two-column-layout.reverse-mobile {
      display: flex;
      flex-direction: column-reverse;
    }
  }

  /* Note: No viewport media queries needed! Columns automatically stack when container is narrow */
  /* Grid intrinsically adapts based on 400px minimum column width */

  /* Accessibility */
  .column:focus-within {
    outline: 2px solid #0066cc;
    outline-offset: 4px;
  }

  /* Print styles */
  @media print {
    .two-column-layout {
      display: block;
    }

    .column {
      page-break-inside: avoid;
      margin-bottom: 1rem;
      aspect-ratio: auto;
      overflow: visible;
      contain: none;
      min-height: auto;
    }

    .column > :global([data-component="quote"]),
    .column > :global([data-component="text"]),
    .column > :global(.portable-text) {
      overflow-y: visible;
      height: auto;
    }
  }
</style>

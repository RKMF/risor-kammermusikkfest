---
import type { Language } from '../lib/utils/language';

interface Props {
  currentLang: Language;
  currentPath: string;
  slugNo?: string;
  slugEn?: string;
}

const { currentLang, currentPath, slugNo, slugEn } = Astro.props;

// Route segment translations (Norwegian â†’ English)
const routeNoToEn: Record<string, string> = {
  'artikler': 'articles',
  'artister': 'artists',
};

const translateRoute = (segment: string, toEnglish: boolean): string => {
  if (toEnglish) {
    return routeNoToEn[segment] || segment;
  }
  // English to Norwegian - reverse lookup
  const entry = Object.entries(routeNoToEn).find(([, en]) => en === segment);
  return entry ? entry[0] : segment;
};

// Build alternate language URL (without trailing slash)
const buildAlternateUrl = (): string => {
  if (currentLang === 'no') {
    // Switching to English
    if (slugEn) {
      // Dynamic page with English slug - also translate route segment
      const pathParts = currentPath.split('/').filter(p => p);
      if (pathParts.length >= 1) {
        pathParts[0] = translateRoute(pathParts[0], true);
      }
      pathParts[pathParts.length - 1] = slugEn;
      return `/en/${pathParts.join('/')}`;
    }
    // Static page - handle root specially
    if (currentPath === '/' || currentPath === '') {
      return '/en';
    }
    return `/en${currentPath}`;
  } else {
    // Switching to Norwegian
    if (slugNo) {
      // Dynamic page with Norwegian slug - also translate route segment
      const pathParts = currentPath.replace(/^\/en\/?/, '').split('/').filter(p => p);
      if (pathParts.length >= 1) {
        pathParts[0] = translateRoute(pathParts[0], false);
      }
      pathParts[pathParts.length - 1] = slugNo;
      return `/${pathParts.join('/')}`;
    }
    // Static page - handle root specially
    const cleanPath = currentPath.replace(/^\/en\/?/, '/');
    if (cleanPath === '/' || cleanPath === '') {
      return '/';
    }
    return cleanPath;
  }
};

const alternateUrl = buildAlternateUrl();
const alternateLang = currentLang === 'no' ? 'en' : 'no';
const alternateLangLabel = currentLang === 'no' ? 'English' : 'Norsk';
---

<div class="language-switcher">
  <a href={alternateUrl} class="link-button" hreflang={alternateLang}>
    {alternateLangLabel}
  </a>
</div>

<style>
  .language-switcher {
    display: inline-flex;
    align-items: center;
  }

  /* Match filter button size */
  .language-switcher .link-button {
    padding: var(--space-2) var(--space-3);
    font-size: var(--step-0);
  }
</style>

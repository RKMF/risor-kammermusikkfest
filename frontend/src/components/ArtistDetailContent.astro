---
import Layout from '../layouts/Layout.astro';
import DynamicComponent from '../components/DynamicComponent.astro';
import ArtistCard from '../components/ArtistCard.astro';
import EventCard from '../components/EventCard.astro';
import ScrollNavigation from '../components/ScrollNavigation.astro';
import { getMultilingualContent } from '../lib/utils/language.js';
import type { ArtistResult } from '../lib/sanity/queries';
import { stegaClean } from '@sanity/client/stega';
import '../styles/event.css';
import '../styles/event-card.css';
import '../styles/artist-card.css';

interface Props {
  artist: ArtistResult;
  language: 'no' | 'en';
}

const { artist, language } = Astro.props;

// Language-specific configuration
const config = {
  no: {
    concertsTitle: 'Konserter',
    aboutTitle: 'Om artisten',
    excerptField: 'excerpt_no',
    contentField: 'content_no'
  },
  en: {
    concertsTitle: 'Concerts',
    aboutTitle: 'About the Artist',
    excerptField: 'excerpt_en',
    contentField: 'content_en'
  }
}[language];

// Get appropriate content array
const content = getMultilingualContent(artist, language) || artist[config.contentField];
const excerpt = artist[config.excerptField];
---

<Layout
  title={stegaClean(artist.name || '')}
  description={excerpt ? stegaClean(excerpt) : undefined}
  slugNo={artist.slug_no?.current}
  slugEn={artist.slug_en?.current}
  seo={artist.seo}
  image={artist.image?.image || artist.image}
>
  <article class="artist-page">
    <!-- Artist Card - Fluid sizing, larger than listing cards -->
    <header class="artist-header">
      <div class="artist-detail-card-container">
        <ArtistCard artist={artist} language={language} size="medium" isDetailPage={true} imageSizes="(min-width: 769px) 45vw, 90vw" />
      </div>

      <!-- Excerpt -->
      {excerpt && (
        <p class="excerpt">{stegaClean(excerpt)}</p>
      )}
    </header>

    <!-- Content below card -->
    {content && Array.isArray(content) && content.length > 0 && (
      <section class="pagebuilder-content">
        <h2 class="sr-only">{config.aboutTitle}</h2>
        {content.map((block) => (
          <DynamicComponent key={block._key || block._id} block={block} />
        ))}
      </section>
    )}

    <!-- Events Section - Last before footer -->
    {artist.events && artist.events.length > 0 && (
      <section class="artist-events">
        <h2 class="artist-events-title">{config.concertsTitle}</h2>
        <div class="scroll-container-wrapper">
          <div class="scroll-container scroll-container--always scroll-container--event-cards scroll-container--styled-scrollbar">
            {artist.events.map((event) => (
              <EventCard event={event} language={language} />
            ))}
          </div>
        </div>
        <ScrollNavigation size="medium" ariaLabel={language === 'no' ? 'Bla gjennom konserter' : 'Scroll through concerts'} />
      </section>
    )}
  </article>
</Layout>

<style>
  /* Artist Header - Grid layout like front page hero */
  .artist-header {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-2xl); /* 48-60px on mobile */
    align-items: center;
    margin-block-end: var(--space-2xl);
  }

  /* On desktop: card and excerpt side by side */
  @media (min-width: 769px) {
    .artist-header {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-xl);
      align-items: center;
    }
  }

  /* Artist Card Container - fluid sizing larger than listing cards */
  .artist-detail-card-container {
    width: clamp(320px, 45vw, 480px);
    justify-self: center;
  }

  /* Excerpt in header */
  .artist-header .excerpt {
    margin: 0;
  }

  /* Override ArtistCard hover effects on detail page */
  .artist-detail-card-container :global(.artist-card) {
    width: 100%;
    cursor: default;
  }

  /* Larger padding for larger card */
  .artist-detail-card-container :global(.artist-info-box) {
    padding: var(--space-l);
  }

  /* Smooth 1.1s transition from blur placeholder to sharp image */
  .artist-detail-card-container :global(.artist-card-image) {
    animation: fadeInImage 1.1s ease-in-out forwards;
  }

  @keyframes fadeInImage {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Increase font sizes proportionally to match 1.5x card growth */
  .artist-detail-card-container :global(.artist-name) {
    font-size: var(--step-3); /* 31-44px vs listing page 22-28px = ~1.5x growth */
  }

  .artist-detail-card-container :global(.artist-instrument) {
    font-size: var(--step-0); /* 18-23px vs listing page 13-14px = ~1.5x growth */
  }

  /* Disable hover effects on detail page - card doesn't link anywhere */
  @media (hover: hover) {
    .artist-detail-card-container :global(.artist-card:hover) {
      transform: none;
      box-shadow: none;
      background-color: var(--color-tint-blue-medium);
    }

    .artist-detail-card-container :global(.artist-card:hover .artist-info-box) {
      background-color: var(--color-card-surface);
    }

    .artist-detail-card-container :global(.artist-card:hover .artist-name),
    .artist-detail-card-container :global(.artist-card:hover .artist-instrument) {
      color: var(--color-blue);
    }
  }

  /* Excerpt styling handled by global .excerpt class in base.css */

  /* Events section */
  .artist-events {
    margin-block-start: var(--space-8);
    margin-block-end: var(--space-8);
  }

  .artist-events-title {
    font-size: var(--step-3);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin-block-start: 0;
    margin-block-end: var(--space-6);
  }

  /* Pagebuilder content spacing - generous space between components */
  .pagebuilder-content {
    margin-block-end: var(--space-3xl);
  }

  .pagebuilder-content > :global(*) {
    margin-block-end: var(--space-3xl);
  }

  .pagebuilder-content > :global(*:last-child) {
    margin-block-end: 0;
  }
</style>

---
import {resolveLinkUrl, detectLanguageFromPath} from '../lib/buildInternalUrl'

interface LinkItem {
  linkType?: 'external' | 'internal'
  text: string
  url?: string
  internalLink?: {
    _type: string
    slug?: string
    slug_no?: string
    slug_en?: string
  }
  description?: string
  openInNewTab?: boolean
}

interface Props {
  links: LinkItem[]
}

const {links = []} = Astro.props

// Detect current language from URL
const currentLanguage = detectLanguageFromPath(Astro.url.pathname)

// Don't render if no links
if (!links || links.length === 0) {
  return null
}

// Process links using shared resolveLinkUrl function
const processedLinks = links.map((link) => ({
  ...link,
  url: resolveLinkUrl(link, currentLanguage),
}))
---

<div class="link-component content-media-narrow">
  <nav aria-label="Lenker">
    <ul class="link-list" role="list">
      {
        processedLinks.map((link) => {
          const target = link.openInNewTab ? '_blank' : undefined
          const rel = link.openInNewTab ? 'noopener noreferrer' : undefined

          return (
            <li class="link-item">
              <a href={link.url} class="link hover-underline" target={target} rel={rel}>
                <span class="link-text">{link.text} →</span>
                {link.openInNewTab && (
                  <span class="visually-hidden"> (åpnes i ny fane)</span>
                )}
              </a>
              {link.description && <p class="link-description">{link.description}</p>}
            </li>
          )
        })
      }
    </ul>
  </nav>
</div>

<style>
  .link-component {
    padding-block: var(--space-m);
  }

  .link-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-s-m);
  }

  .link-item {
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-2xs);
  }

  .link {
    display: inline-flex;
    align-items: center;
    padding: var(--space-2xs) var(--space-xs);
    font-weight: var(--font-weight-medium);
    font-size: var(--step-3);
    line-height: var(--line-height-heading);
    background-image: none;
  }


  /* Focus state uses global styles, just add background */
  .link:focus-visible {
    background-color: var(--color-tint-blue-light);
  }

  .link-description {
    margin: 0;
    font-size: var(--step-0);
    color: var(--color-text-secondary);
    line-height: 1.5;
    padding-inline-start: calc(var(--space-xs) + var(--space-s));
  }

  /* Visually hidden utility for screen readers */
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
</style>

---
import ArtistDetailContent from '../../components/ArtistDetailContent.astro';
import { createDataService } from '../../lib/sanity/dataService.js';
import type { ArtistResult } from '../../lib/sanity/queries';
import { stegaClean } from '@sanity/client/stega';

export async function getStaticPaths() {
  if (import.meta.env.DEV) return [];

  const dataService = createDataService();
  const artists = await dataService.getArtistPage();
  return artists.map((artist) => ({
    params: { slug: stegaClean(artist.slug) }
  }));
}

const { slug } = Astro.params;
if (!slug) return Astro.redirect('/404');

const dataService = createDataService(Astro.request);
let artist: ArtistResult | null = null;

try {
  artist = await dataService.getArtistBySlug(slug);
  if (!artist) return Astro.redirect('/404');
} catch (error) {
  console.error(`Error loading artist "${slug}":`, error);
  return Astro.redirect('/404');
}
---

<ArtistDetailContent artist={artist} language="no" />

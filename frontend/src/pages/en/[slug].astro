---
import ContentPageLayout from '../../layouts/ContentPageLayout.astro';
import { createDataService } from '../../lib/sanity/dataService.js';

export async function getStaticPaths() {
  if (import.meta.env.DEV) return [];
  const dataService = createDataService();
  const pages = await dataService.getSlugsForType('page');
  return pages.map((page: any) => ({ params: page.params }));
}

const dataService = createDataService(Astro.request);
const page = await dataService.getPageBySlug(Astro.params.slug);

if (!page) {
  return Astro.redirect('/en/404');
}
---

<ContentPageLayout title={page.title} pageDocument={page} />

---
import ContentPageLayout from '../layouts/ContentPageLayout.astro';
import ArtistCard from '../components/ArtistCard.astro';
import { createDataService } from '../lib/sanity/dataService.js';
import { stegaClean } from '@sanity/client/stega';
import '../styles/artist-card.css';
import '../styles/artists.css';

// Create data service with Visual Editing support
const dataService = createDataService(Astro.request);

// Hent artister-siden innhold fra artistPage schema
const artistsPage = await dataService.getArtistPage();

// Bruk kun valgte artister fra artistPage
const allArtists = artistsPage?.selectedArtists || [];

// Group artists by cardSize - maintains selectedArtists array order
const largeArtists = allArtists.filter((artist) => stegaClean(artist.cardSize) === 'stor');
const mediumArtists = allArtists.filter((artist) => stegaClean(artist.cardSize) === 'medium');

// Fallback values
const pageTitle = artistsPage?.title || 'Artister';

// Check if we have any artists
const hasArtists = allArtists.length > 0;
---

<ContentPageLayout
  title={pageTitle}
  excerpt={artistsPage?.excerpt}
  pageDocument={artistsPage}
>
  {hasArtists ? (
    <div class="artist-sections">
      {/* Hidden SVG for wave clip-path definitions */}
      <svg width="0" height="0" style="position: absolute;" aria-hidden="true">
        <defs>
          {/* Large cards - line 6 wave pattern with two peaks and one valley */}
          <clipPath id="artist-wave-clip-large" clipPathUnits="objectBoundingBox">
            <path d="M 0 0.06 C 0.08 0.06, 0.12 0.04, 0.17 0.015 C 0.22 0, 0.28 0, 0.33 0.015 C 0.38 0.03, 0.42 0.06, 0.5 0.06 C 0.58 0.06, 0.62 0.03, 0.67 0.015 C 0.72 0, 0.78 0, 0.83 0.015 C 0.88 0.04, 0.92 0.06, 1 0.06 L 1 1 L 0 1 Z"/>
          </clipPath>

          {/* Medium cards - top shallow wave pattern from logo (line 7) */}
          <clipPath id="artist-wave-clip-medium" clipPathUnits="objectBoundingBox">
            <path d="M 0 0.015 C 0.035 0.006, 0.077 0, 0.136 0 C 0.234 0, 0.286 0.01, 0.333 0.022 C 0.377 0.033, 0.415 0.048, 0.499 0.048 C 0.583 0.048, 0.621 0.033, 0.665 0.022 C 0.712 0.01, 0.764 0, 0.862 0 C 0.921 0, 0.963 0.006, 0.998 0.015 L 1 0.015 L 1 1 L 0 1 Z" />
          </clipPath>
        </defs>
      </svg>

      {/* Large Artists Section */}
      {largeArtists.length > 0 && (
        <div class="artist-section artist-section--large scroll-container scroll-container--artist-cards scroll-container--styled-scrollbar">
          {largeArtists.map((artist) => (
            <ArtistCard artist={artist} language="no" size="large" />
          ))}
        </div>
      )}

      {/* Medium Artists Section */}
      {mediumArtists.length > 0 && (
        <div class="artist-section artist-section--medium scroll-container scroll-container--artist-cards scroll-container--styled-scrollbar">
          {mediumArtists.map((artist) => (
            <ArtistCard artist={artist} language="no" size="medium" />
          ))}
        </div>
      )}
    </div>
  ) : (
    <div class="no-artists">
      <h3 class="no-artists-title">Ingen artister publisert</h3>
      <p class="no-artists-text">Kom tilbake senere for å se våre artister.</p>
    </div>
  )}
</ContentPageLayout>